/**
* Name: DutchAuction
* Based on the internal empty template. 
* Author: Zidi Chen, Sihan Chen
* Tags: 
*/


model DutchAuction

global
{
	int number_of_auctioneer<-1;
	int number_of_participant<-10;
	init
	{
		create Participant number:number_of_participant;
		create Auctioneer number:number_of_auctioneer{
			location<-{50,50};
		}
	}
	
}

species Auctioneer skills:[fipa]
{
	bool startAuction;
	int initialPrice;
	int minPrice;
	int round;
	list<Participant> participantList;
	
	init
	{
		
	}
	
		
	reflex startAuction when: time = 1 {
		
		participantList << Participant;
		write '(Time ' + time + '): ' + name + ' sends an cfp message to participants: the auction is going to start!';
		do start_conversation (to: participantList, protocol: 'no-protocol', performative: 'inform', contents: ['we are going to sell this craft ', item]);
	}
	
	
//	reflex send_request when:(time=1)
//	{
//		Participant p<- Participant at 0;
//		write "send message";
//		do start_conversation (to::[p], protocal::'fipa-request',performative::'request',contents::['go sleeping']);
//	}
//	
//	reflex read_agree_message when: !(empty(agree))
//	{
//		loop a over:agrees
//		{
//			write "agree message with content: " + string(a.contents);
//		}
//	}
//	
//	reflex read_failure_message when: !(empty(failures))
//	{
//		loop f over:failures
//		{
//			write "failure message with content: " + string(f.contents);
//		}
//	}
	
	aspect base
	{
		draw circle(3) color: #yellow;
	}
}

species Participant skills:[fipa]
{
	rgb color <- #grey;
	
//	reflex reply_message when:(!empty(requests))
//	{
//		message requestFromAuctioneer<-(requests at 0);
//		do agree with : (message:requestFromAcutioneer,contents:['I will']);
//		
//		write 'inform failure';
//		do failure (message:requestFromAcutioneer,contents:['broken']);
//	}
	
	aspect base
	{
		draw circle(2) color: color;
	}
}


species Arena
{
	aspect base
	{
		draw circle(15) color: #purple;
	}
}

experiment main type:gui
{
	output
	{
		display map type:opengl
		{
			
			
			species Arena aspect:base;
			
			
		}
	}
	
}